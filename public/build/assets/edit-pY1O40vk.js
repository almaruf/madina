const u=new URLSearchParams(window.location.search),a=u.get("id")||window.location.pathname.split("/").pop();function l(){const t=document.getElementById("offer-type").value;switch(document.getElementById("field-discount-value").classList.add("hidden"),document.getElementById("field-bxgy").classList.add("hidden"),document.getElementById("field-get-discount").classList.add("hidden"),document.getElementById("field-bundle-price").classList.add("hidden"),t){case"percentage_discount":case"fixed_discount":case"flash_sale":document.getElementById("field-discount-value").classList.remove("hidden");break;case"bxgy_free":document.getElementById("field-bxgy").classList.remove("hidden");break;case"multibuy":document.getElementById("field-bxgy").classList.remove("hidden"),document.getElementById("field-bundle-price").classList.remove("hidden");break;case"bxgy_discount":document.getElementById("field-bxgy").classList.remove("hidden"),document.getElementById("field-get-discount").classList.remove("hidden");break;case"bundle":document.getElementById("field-bundle-price").classList.remove("hidden");break}}async function i(){var t,d;try{const e=(await axios.get(`/api/admin/offers/${a}`)).data;document.getElementById("offer-id").value=e.id,document.getElementById("offer-name").value=e.name,document.getElementById("offer-description").value=e.description||"",document.getElementById("offer-type").value=e.type,document.getElementById("discount-value").value=e.discount_value||"",document.getElementById("buy-quantity").value=e.buy_quantity||"",document.getElementById("get-quantity").value=e.get_quantity||"",document.getElementById("get-discount-percentage").value=e.get_discount_percentage||"",document.getElementById("bundle-price").value=e.bundle_price||"",document.getElementById("badge-text").value=e.badge_text||"",document.getElementById("badge-color").value=e.badge_color||"#DC2626",document.getElementById("min-purchase-amount").value=e.min_purchase_amount||"",document.getElementById("max-uses-per-customer").value=e.max_uses_per_customer||"",document.getElementById("total-usage-limit").value=e.total_usage_limit||"",document.getElementById("priority").value=e.priority||0,document.getElementById("is-active").checked=e.is_active,e.starts_at&&(document.getElementById("starts-at").value=new Date(e.starts_at).toISOString().slice(0,16)),e.ends_at&&(document.getElementById("ends-at").value=new Date(e.ends_at).toISOString().slice(0,16)),l(),document.getElementById("loading-container").classList.add("hidden"),document.getElementById("offer-form").classList.remove("hidden")}catch(n){console.error("Error loading offer:",n);const e=((d=(t=n.response)==null?void 0:t.data)==null?void 0:d.message)||n.message;window.toast.error("Failed to load offer: "+e),document.getElementById("loading-container").classList.add("hidden"),document.getElementById("offer-form").classList.remove("hidden")}}async function c(){if(confirm("Are you sure you want to delete this offer? This action cannot be undone."))try{await axios.delete(`/api/admin/offers/${a}`),window.toast.success("Offer deleted successfully!"),setTimeout(()=>{window.location.href="/admin/offers"},1e3)}catch(t){console.error("Error deleting offer:",t),window.toast.error("Failed to delete offer")}}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("offer-form").addEventListener("submit",async t=>{var n,e;t.preventDefault();const d={name:document.getElementById("offer-name").value,description:document.getElementById("offer-description").value,type:document.getElementById("offer-type").value,discount_value:document.getElementById("discount-value").value||null,buy_quantity:document.getElementById("buy-quantity").value||null,get_quantity:document.getElementById("get-quantity").value||null,get_discount_percentage:document.getElementById("get-discount-percentage").value||null,bundle_price:document.getElementById("bundle-price").value||null,starts_at:document.getElementById("starts-at").value||null,ends_at:document.getElementById("ends-at").value||null,badge_text:document.getElementById("badge-text").value||null,badge_color:document.getElementById("badge-color").value,min_purchase_amount:document.getElementById("min-purchase-amount").value||null,max_uses_per_customer:document.getElementById("max-uses-per-customer").value||null,total_usage_limit:document.getElementById("total-usage-limit").value||null,priority:document.getElementById("priority").value||0,is_active:document.getElementById("is-active").checked};try{await axios.put(`/api/admin/offers/${a}`,d),window.toast.success("Offer updated successfully!"),setTimeout(()=>{window.location.href="/admin/offers"},1e3)}catch(o){console.error("Error updating offer:",o);const s=((e=(n=o.response)==null?void 0:n.data)==null?void 0:e.message)||o.message;window.toast.error("Failed to update offer: "+s)}}),i()});window.updateFormFields=l;window.deleteOffer=c;
