let p=!1;function d(t){const e=document.getElementById("error-message");e.textContent=t,e.classList.remove("hidden"),e.classList.remove("bg-green-50","border-green-200","text-green-700"),e.classList.add("bg-red-50","border-red-200","text-red-700")}function f(t){const e=document.getElementById("error-message");e.textContent=t,e.classList.remove("hidden"),e.classList.add("bg-green-50","border-green-200","text-green-700"),e.classList.remove("bg-red-50","border-red-200","text-red-700")}document.addEventListener("DOMContentLoaded",async()=>{try{(await axios.get("/api/auth/user")).data&&(window.location.href="/admin")}catch{}document.getElementById("login-form").addEventListener("submit",async t=>{var c,m,g,u;t.preventDefault();const e=document.getElementById("phone").value,r=document.getElementById("otp").value,v=document.getElementById("error-message"),n=document.getElementById("loading-message"),l=document.getElementById("loading-text"),o=document.getElementById("submit-btn");if(v.classList.add("hidden"),p){if(!r||r.length!==6){d("Please enter a valid 6-digit OTP");return}n.classList.remove("hidden"),l.textContent="Verifying OTP...",o.disabled=!0;try{const i=document.getElementById("phone-prefix").value+e,h=await axios.post("/api/admin/verify-otp",{phone:i,otp:r});n.classList.add("hidden");const a=h.data.token;console.log("Token received:",a),localStorage.setItem("auth_token",a),console.log("Token stored in localStorage:",localStorage.getItem("auth_token")),sessionStorage.setItem("auth_token",a),f("Login successful! Redirecting..."),setTimeout(()=>{console.log("Redirecting to /admin..."),window.location.href="/admin"},500)}catch(s){n.classList.add("hidden"),o.disabled=!1,console.error("OTP verification error:",s),d(((u=(g=s.response)==null?void 0:g.data)==null?void 0:u.message)||"Failed to verify OTP")}}else{if(!e){d("Please enter your phone number");return}n.classList.remove("hidden"),l.textContent="Sending OTP...",o.disabled=!0;try{const i=document.getElementById("phone-prefix").value+e,h=await axios.post("/api/admin/login",{phone:i});n.classList.add("hidden"),o.disabled=!1,p=!0,document.getElementById("otp-section").classList.remove("hidden"),o.textContent="Verify & Login",f("OTP sent! Check your SMS.")}catch(s){n.classList.add("hidden"),o.disabled=!1,d(((m=(c=s.response)==null?void 0:c.data)==null?void 0:m.message)||"Failed to send OTP")}}})});
