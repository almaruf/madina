let c=null;function m(){const e=document.querySelector("[data-shop-slug]");return e?e.dataset.shopSlug:null}function _(){const e=document.querySelectorAll(".tab-btn"),r=document.querySelectorAll(".tab-content");e.forEach(a=>{a.addEventListener("click",()=>{const n=a.dataset.tab;e.forEach(t=>{t.classList.remove("active","border-blue-500","text-blue-600"),t.classList.add("border-transparent","text-gray-500")}),a.classList.remove("border-transparent","text-gray-500"),a.classList.add("active","border-blue-500","text-blue-600"),r.forEach(t=>{t.classList.add("hidden")}),document.getElementById(`tab-${n}`).classList.remove("hidden")})})}async function v(){const e=m();if(!e){console.error("Shop slug not found");return}try{c=(await axios.get(`/api/admin/shops/${e}`)).data,S(c),document.getElementById("loading").classList.add("hidden"),document.getElementById("shop-form-container").classList.remove("hidden")}catch(r){console.error("Error loading shop:",r),document.getElementById("loading").classList.add("hidden"),window.toast.error("Failed to load shop details")}}function S(e){const r=document.getElementById("form-basic");r.querySelector('[name="name"]').value=e.name||"",r.querySelector('[name="slug"]').value=e.slug||"",r.querySelector('[name="description"]').value=e.description||"",r.querySelector('[name="tagline"]').value=e.tagline||"",r.querySelector('[name="domain"]').value=e.domain||"",r.querySelector('[name="business_type"]').value=e.business_type||"grocery",r.querySelector('[name="specialization"]').value=e.specialization||"general",r.querySelector('[name="phone"]').value=e.phone||"",r.querySelector('[name="email"]').value=e.email||"",r.querySelector('[name="support_email"]').value=e.support_email||"",r.querySelector('[name="whatsapp_number"]').value=e.whatsapp_number||"",r.querySelector('[name="address_line_1"]').value=e.address_line_1||"",r.querySelector('[name="address_line_2"]').value=e.address_line_2||"",r.querySelector('[name="city"]').value=e.city||"",r.querySelector('[name="postcode"]').value=e.postcode||"",r.querySelector('[name="country"]').value=e.country||"United Kingdom",r.querySelector('[name="is_active"]').checked=e.is_active;const a=document.getElementById("form-delivery");a.querySelector('[name="currency"]').value=e.currency||"GBP",a.querySelector('[name="currency_symbol"]').value=e.currency_symbol||"Â£",a.querySelector('[name="delivery_fee"]').value=e.delivery_fee||0,a.querySelector('[name="min_order_amount"]').value=e.min_order_amount||0,a.querySelector('[name="free_delivery_threshold"]').value=e.free_delivery_threshold||0,a.querySelector('[name="delivery_radius_km"]').value=e.delivery_radius_km||10,a.querySelector('[name="delivery_enabled"]').checked=e.delivery_enabled,a.querySelector('[name="collection_enabled"]').checked=e.collection_enabled,a.querySelector('[name="online_payment"]').checked=e.online_payment,a.querySelector('[name="has_halal_products"]').checked=e.has_halal_products,a.querySelector('[name="has_organic_products"]').checked=e.has_organic_products;const n=document.getElementById("form-legal");n.querySelector('[name="legal_company_name"]').value=e.legal_company_name||"",n.querySelector('[name="company_registration_number"]').value=e.company_registration_number||"",n.querySelector('[name="vat_registered"]').checked=e.vat_registered||!1,n.querySelector('[name="vat_number"]').value=e.vat_number||"",n.querySelector('[name="vat_rate"]').value=e.vat_rate||"",n.querySelector('[name="prices_include_vat"]').checked=e.prices_include_vat!==!1;const t=document.getElementById("form-bank");t.querySelector('[name="bank_name"]').value=e.bank_name||"",t.querySelector('[name="bank_account_name"]').value=e.bank_account_name||"",t.querySelector('[name="bank_account_number"]').value=e.bank_account_number||"",t.querySelector('[name="bank_sort_code"]').value=e.bank_sort_code||"",t.querySelector('[name="bank_iban"]').value=e.bank_iban||"",t.querySelector('[name="bank_swift_code"]').value=e.bank_swift_code||"";const l=document.getElementById("form-branding");l.querySelector('[name="primary_color"]').value=e.primary_color||"#10b981",l.querySelector('[name="secondary_color"]').value=e.secondary_color||"#059669",l.querySelector('[name="logo_url"]').value=e.logo_url||"",l.querySelector('[name="favicon_url"]').value=e.favicon_url||"",l.querySelector('[name="facebook_url"]').value=e.facebook_url||"",l.querySelector('[name="instagram_url"]').value=e.instagram_url||"",l.querySelector('[name="twitter_url"]').value=e.twitter_url||"";const u=document.getElementById("form-hours");u.querySelector('[name="monday_hours"]').value=e.monday_hours||"",u.querySelector('[name="tuesday_hours"]').value=e.tuesday_hours||"",u.querySelector('[name="wednesday_hours"]').value=e.wednesday_hours||"",u.querySelector('[name="thursday_hours"]').value=e.thursday_hours||"",u.querySelector('[name="friday_hours"]').value=e.friday_hours||"",u.querySelector('[name="saturday_hours"]').value=e.saturday_hours||"",u.querySelector('[name="sunday_hours"]').value=e.sunday_hours||""}function b(e){const r=new FormData(e),a={};for(const[n,t]of r.entries()){const l=e.querySelector(`[name="${n}"]`);l&&l.type==="checkbox"?a[n]=l.checked:l&&l.type==="number"?a[n]=t?parseFloat(t):null:a[n]=t||null}return a}async function g(e){var u,d,i,s;e.preventDefault();const r=e.target,a=r.dataset.formType,n=m();if(!n)return;const t=r.querySelector('button[type="submit"]'),l=t.textContent;t.disabled=!0,t.textContent="Updating...";try{const o=b(r);"vat_rate"in o&&delete o.vat_rate,await axios.patch(`/api/admin/shops/${n}`,o),Object.assign(c,o),window.toast.success(`${q(a)} updated successfully!`),a==="basic"&&o.slug&&o.slug!==n&&setTimeout(()=>{window.location.href="/admin/shops/"+o.slug+"/edit"},1e3)}catch(o){if(console.error(`Error updating ${a}:`,o),(d=(u=o.response)==null?void 0:u.data)!=null&&d.errors){const y=Object.values(o.response.data.errors).flat();window.toast.error(y.join("<br>"))}else window.toast.error(((s=(i=o.response)==null?void 0:i.data)==null?void 0:s.message)||`Failed to update ${a}`)}finally{t.disabled=!1,t.textContent=l}}function q(e){return{basic:"Basic Information",delivery:"Delivery & Pricing",legal:"Legal & VAT",bank:"Bank Details",branding:"Branding & Social",hours:"Operating Hours"}[e]||e}document.addEventListener("DOMContentLoaded",()=>{_(),v(),document.querySelectorAll("form[data-form-type]").forEach(e=>{e.addEventListener("submit",g)})});
