function u(){const e=localStorage.getItem("auth_token")||sessionStorage.getItem("auth_token");return e?{Authorization:`Bearer ${e}`}:{}}let l=[],p=[],a=[];async function h(){try{const e=await axios.get("/api/admin/categories",{headers:u()});p=e.data.data||e.data,w()}catch(e){console.error("Error loading categories:",e),window.toast.error("Failed to load categories")}}function w(){const e=document.getElementById("selected-category"),o=document.getElementById("product-category-filter");p.forEach(t=>{const n=document.createElement("option");n.value=t.id,n.textContent=t.name,e.appendChild(n);const c=document.createElement("option");c.value=t.id,c.textContent=t.name,o.appendChild(c)})}function x(){const e=document.querySelector('input[name="product-scope"]:checked').value;document.getElementById("category-selection").classList.add("hidden"),document.getElementById("product-selection").classList.add("hidden"),e==="category"?document.getElementById("category-selection").classList.remove("hidden"):e==="selected"&&document.getElementById("product-selection").classList.remove("hidden")}async function _(){try{const e=await axios.get("/api/admin/products?per_page=1000",{headers:u()});l=e.data.data||e.data,f(l),document.getElementById("product-modal").classList.remove("hidden")}catch(e){console.error("Error loading products:",e),window.toast.error("Failed to load products")}}function y(){document.getElementById("product-modal").classList.add("hidden")}function f(e){const o=document.getElementById("products-list");o.innerHTML=e.map(t=>{var r,m,g;const n=((r=t.primary_image)==null?void 0:r.url)||null,c=((m=t.variations)==null?void 0:m.find(i=>i.is_default))||((g=t.variations)==null?void 0:g[0]),s=c!=null&&c.price?`Â£${parseFloat(c.price).toFixed(2)}`:"No price",d=(t.categories||[]).map(i=>`<span class="px-2 py-0.5 bg-gray-100 text-gray-600 rounded-full text-xs">${i.name}</span>`).join("");return`
        <label class="flex items-start gap-3 p-3 border rounded-lg cursor-pointer hover:bg-gray-50 mb-2">
            <input type="checkbox" value="${t.id}" class="product-checkbox mt-1"
                ${a.includes(t.id)?"checked":""}>
            <div class="w-14 h-14 flex-shrink-0 bg-gray-100 rounded-lg overflow-hidden">
                ${n?`<img src="${n}" alt="${t.name}" class="w-full h-full object-cover">`:'<div class="w-full h-full flex items-center justify-center text-gray-400"><i class="fas fa-image"></i></div>'}
            </div>
            <div class="flex-1 min-w-0">
                <div class="flex items-center justify-between gap-2">
                    <div class="font-semibold truncate">${t.name}</div>
                    <div class="text-sm font-semibold text-green-600">${s}</div>
                </div>
                <div class="text-xs text-gray-500">SKU: ${t.sku||"N/A"}</div>
                ${d?`<div class="flex flex-wrap gap-1 mt-2">${d}</div>`:""}
            </div>
        </label>
        `}).join("")}function E(){const e=document.getElementById("product-search").value.toLowerCase(),o=document.getElementById("product-category-filter").value,t=l.filter(n=>{var d;const c=n.name.toLowerCase().includes(e)||n.sku&&n.sku.toLowerCase().includes(e),s=!o||((d=n.categories)==null?void 0:d.some(r=>r.id==o));return c&&s});f(t)}function I(){a=Array.from(document.querySelectorAll(".product-checkbox:checked")).map(e=>parseInt(e.value)),v(),y()}function v(){const e=document.getElementById("selected-products-display"),o=l.filter(t=>a.includes(t.id));e.innerHTML=o.length>0?o.map(t=>`
            <div class="flex items-center justify-between p-2 bg-gray-50 rounded-lg">
                <span class="text-sm">${t.name}</span>
                <button type="button" onclick="window.removeProduct(${t.id})" class="text-red-600 hover:text-red-700">
                    <i class="fas fa-trash"></i>
                </button>
            </div>
        `).join(""):'<p class="text-gray-500 text-sm">No products selected</p>'}function b(e){a=a.filter(o=>o!==e),v()}function B(){a=[],document.querySelectorAll(".product-checkbox").forEach(e=>e.checked=!1)}async function P(e){var n,c;e.preventDefault();const o=document.querySelector('input[name="product-scope"]:checked').value;if(o==="selected"&&a.length===0){window.toast.error("Please select at least one product");return}if(o==="category"&&!document.getElementById("selected-category").value){window.toast.error("Please select a category");return}const t={name:document.getElementById("name").value,type:"percentage_discount",description:document.getElementById("description").value||null,badge_text:document.getElementById("badge_text").value||null,badge_color:document.getElementById("badge_color").value,discount_value:document.getElementById("discount_value").value,min_purchase_amount:document.getElementById("min_purchase_amount").value||null,max_uses_per_customer:document.getElementById("max_uses_per_customer").value||null,total_usage_limit:document.getElementById("total_usage_limit").value||null,starts_at:document.getElementById("starts_at").value||null,ends_at:document.getElementById("ends_at").value||null,is_active:document.getElementById("is_active").checked,scope:o,category_id:o==="category"?document.getElementById("selected-category").value:null,product_ids:o==="selected"?a:[]};try{await axios.post("/api/admin/offers",t,{headers:u()}),window.toast.success("Offer created successfully"),setTimeout(()=>window.location.href="/admin/offers",1500)}catch(s){console.error("Error creating offer:",s);const d=((c=(n=s.response)==null?void 0:n.data)==null?void 0:c.message)||"Failed to create offer";window.toast.error(d)}}window.handleProductScopeChange=x;window.openProductModal=_;window.closeProductModal=y;window.searchProducts=E;window.confirmProductSelection=I;window.clearProductSelection=B;window.removeProduct=b;window.handleSubmit=P;document.addEventListener("DOMContentLoaded",()=>{h()});
