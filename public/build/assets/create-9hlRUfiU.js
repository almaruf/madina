let c=[];async function l(){try{const e=await axios.get("/api/admin/categories");c=e.data.data||e.data;const t=document.getElementById("categories");t.innerHTML=c.filter(a=>a.is_active).map(a=>`<option value="${a.id}">${a.name}</option>`).join("")}catch(e){console.error("Error loading categories:",e),window.toast.error("Failed to load categories")}}function u(){const e=document.getElementById("name"),t=document.getElementById("slug");e.addEventListener("input",a=>{const o=a.target.value.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,"");t.value=o})}function m(){const e=Array.from(document.getElementById("categories").selectedOptions).map(a=>parseInt(a.value));if(e.length===0)throw new Error("Please select at least one category");return{name:document.getElementById("name").value.trim(),slug:document.getElementById("slug").value.trim(),description:document.getElementById("description").value.trim()||null,short_description:document.getElementById("short_description").value.trim()||null,type:document.getElementById("type").value,brand:document.getElementById("brand").value.trim()||null,is_active:document.getElementById("is_active").checked,is_featured:document.getElementById("is_featured").checked,is_halal:document.getElementById("is_halal").checked,categories:e,variations:[{size:document.getElementById("variation_size").value.trim(),unit:document.getElementById("variation_unit").value,price:parseFloat(document.getElementById("variation_price").value),compare_at_price:document.getElementById("variation_compare_at_price").value?parseFloat(document.getElementById("variation_compare_at_price").value):null,stock_quantity:parseInt(document.getElementById("variation_stock_quantity").value)||0,sku:document.getElementById("variation_sku").value.trim()||null,barcode:document.getElementById("variation_barcode").value.trim()||null,is_default:!0,is_active:!0}]}}async function g(e){var o,i,s,d;e.preventDefault();const t=document.getElementById("submit-btn"),a=t.textContent;t.disabled=!0,t.textContent="Creating...";try{const n=m(),r=await axios.post("/api/admin/products",n);window.toast.success("Product created successfully!"),setTimeout(()=>{window.location.href="/admin/products/"+r.data.slug},1e3)}catch(n){if(console.error("Error creating product:",n),t.disabled=!1,t.textContent=a,n.message)window.toast.error(n.message);else if((i=(o=n.response)==null?void 0:o.data)!=null&&i.errors){const r=Object.values(n.response.data.errors).flat();window.toast.error(r.join("<br>"))}else window.toast.error(((d=(s=n.response)==null?void 0:s.data)==null?void 0:d.message)||"Failed to create product")}}document.addEventListener("DOMContentLoaded",()=>{u(),l(),document.getElementById("product-form").addEventListener("submit",g)});
