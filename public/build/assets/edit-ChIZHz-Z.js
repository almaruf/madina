let m=null;function _(){const e=document.querySelector("[data-shop-slug]");return e?e.dataset.shopSlug:null}function g(){const e=document.querySelectorAll(".tab-btn"),a=document.querySelectorAll(".tab-content");e.forEach(n=>{n.addEventListener("click",()=>{const t=n.dataset.tab;e.forEach(o=>{o.classList.remove("active","border-blue-500","text-blue-600"),o.classList.add("border-transparent","text-gray-500")}),n.classList.remove("border-transparent","text-gray-500"),n.classList.add("active","border-blue-500","text-blue-600"),a.forEach(o=>{o.classList.add("hidden")}),document.getElementById(`tab-${t}`).classList.remove("hidden")})})}async function v(){const e=_();if(!e){console.error("Shop slug not found");return}try{m=(await axios.get(`/api/admin/shops/${e}`)).data,f(m),document.getElementById("loading").classList.add("hidden"),document.getElementById("shop-form-container").classList.remove("hidden")}catch(a){console.error("Error loading shop:",a),document.getElementById("loading").classList.add("hidden"),window.toast.error("Failed to load shop details")}}function f(e){const a=document.getElementById("form-basic");a.querySelector('[name="name"]').value=e.name||"",a.querySelector('[name="slug"]').value=e.slug||"",a.querySelector('[name="description"]').value=e.description||"",a.querySelector('[name="tagline"]').value=e.tagline||"",a.querySelector('[name="domain"]').value=e.domain||"",a.querySelector('[name="business_type"]').value=e.business_type||"grocery",a.querySelector('[name="specialization"]').value=e.specialization||"general",a.querySelector('[name="phone"]').value=e.phone||"",a.querySelector('[name="email"]').value=e.email||"",a.querySelector('[name="support_email"]').value=e.support_email||"",a.querySelector('[name="whatsapp_number"]').value=e.whatsapp_number||"",a.querySelector('[name="address_line_1"]').value=e.address_line_1||"",a.querySelector('[name="address_line_2"]').value=e.address_line_2||"",a.querySelector('[name="city"]').value=e.city||"",a.querySelector('[name="postcode"]').value=e.postcode||"",a.querySelector('[name="country"]').value=e.country||"United Kingdom",a.querySelector('[name="is_active"]').checked=!!e.is_active;const n=document.getElementById("form-delivery");n.querySelector('[name="currency"]').value=e.currency||"GBP",n.querySelector('[name="currency_symbol"]').value=e.currency_symbol||"Â£",n.querySelector('[name="delivery_fee"]').value=e.delivery_fee||0,n.querySelector('[name="min_order_amount"]').value=e.min_order_amount||0,n.querySelector('[name="free_delivery_threshold"]').value=e.free_delivery_threshold||0,n.querySelector('[name="delivery_radius_km"]').value=e.delivery_radius_km||10,n.querySelector('[name="delivery_enabled"]').checked=!!e.delivery_enabled,n.querySelector('[name="collection_enabled"]').checked=!!e.collection_enabled,n.querySelector('[name="online_payment"]').checked=!!e.online_payment,n.querySelector('[name="has_halal_products"]').checked=!!e.has_halal_products,n.querySelector('[name="has_organic_products"]').checked=!!e.has_organic_products;const t=document.getElementById("form-legal");t.querySelector('[name="legal_company_name"]').value=e.legal_company_name||"",t.querySelector('[name="company_registration_number"]').value=e.company_registration_number||"",t.querySelector('[name="vat_registered"]').checked=!!e.vat_registered,t.querySelector('[name="vat_number"]').value=e.vat_number||"",t.querySelector('[name="vat_rate"]').value=e.vat_rate||"",t.querySelector('[name="prices_include_vat"]').checked=!!e.prices_include_vat;const o=document.getElementById("form-bank");o.querySelector('[name="bank_name"]').value=e.bank_name||"",o.querySelector('[name="bank_account_name"]').value=e.bank_account_name||"",o.querySelector('[name="bank_account_number"]').value=e.bank_account_number||"",o.querySelector('[name="bank_sort_code"]').value=e.bank_sort_code||"",o.querySelector('[name="bank_iban"]').value=e.bank_iban||"",o.querySelector('[name="bank_swift_code"]').value=e.bank_swift_code||"";const l=document.getElementById("form-branding");l.querySelector('[name="primary_color"]').value=e.primary_color||"#10b981",l.querySelector('[name="secondary_color"]').value=e.secondary_color||"#059669",l.querySelector('[name="logo_url"]').value=e.logo_url||"",l.querySelector('[name="favicon_url"]').value=e.favicon_url||"",l.querySelector('[name="facebook_url"]').value=e.facebook_url||"",l.querySelector('[name="instagram_url"]').value=e.instagram_url||"",l.querySelector('[name="twitter_url"]').value=e.twitter_url||"";const s=document.getElementById("form-hours");["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].forEach(c=>{const i=s.querySelector(`[name="${c}_open"]`),r=s.querySelector(`[name="${c}_close"]`),u=s.querySelector(`[name="${c}_closed"]`);i&&e[`${c}_open`]&&(i.value=e[`${c}_open`].substring(0,5)),r&&e[`${c}_close`]&&(r.value=e[`${c}_close`].substring(0,5)),u&&(u.checked=e[`${c}_closed`]||!1,u.checked&&toggleDayClosed(c))})}function S(e){const a={};return e.querySelectorAll("input, select, textarea").forEach(t=>{t.name&&(t.type==="checkbox"?a[t.name]=t.checked:t.type==="number"?a[t.name]=t.value?parseFloat(t.value):null:t.type==="time"&&t.disabled||(a[t.name]=t.value||null))}),["monday","tuesday","wednesday","thursday","friday","saturday","sunday"].forEach(t=>{const o=`${t}_closed`;a[o]===!0&&(console.log(`Day ${t} is closed, clearing times`),a[`${t}_open`]=null,a[`${t}_close`]=null)}),console.log("Final form data:",a),a}async function b(e){var s,d,c,i;e.preventDefault();const a=e.target,n=a.dataset.formType,t=_();if(!t)return;const o=a.querySelector('button[type="submit"]'),l=o.textContent;o.disabled=!0,o.textContent="Updating...";try{const r=S(a);"vat_rate"in r&&delete r.vat_rate,m=(await axios.patch(`/api/admin/shops/${t}`,r)).data,f(m),window.toast.success(`${q(n)} updated successfully!`),n==="basic"&&r.slug&&r.slug!==t&&setTimeout(()=>{window.location.href="/admin/shops/"+r.slug+"/edit"},1e3)}catch(r){if(console.error(`Error updating ${n}:`,r),(d=(s=r.response)==null?void 0:s.data)!=null&&d.errors){const u=Object.values(r.response.data.errors).flat();window.toast.error(u.join("<br>"))}else window.toast.error(((i=(c=r.response)==null?void 0:c.data)==null?void 0:i.message)||`Failed to update ${n}`)}finally{o.disabled=!1,o.textContent=l}}function q(e){return{basic:"Basic Information",delivery:"Delivery & Pricing",legal:"Legal & VAT",bank:"Bank Details",branding:"Branding & Social",hours:"Operating Hours"}[e]||e}window.toggleDayClosed=function(e,a=null){console.log(`toggleDayClosed called for ${e}, element passed:`,!!a),setTimeout(()=>{const n=a||document.querySelector(`input[name="${e}_closed"]`),t=document.querySelector(`input[name="${e}_open"]`),o=document.querySelector(`input[name="${e}_close"]`);console.log(`toggleDayClosed(${e}): checkbox found = ${!!n}, checked = ${n==null?void 0:n.checked}`),n&&n.checked?(t&&(t.disabled=!0,t.value="",t.classList.add("bg-gray-100","cursor-not-allowed")),o&&(o.disabled=!0,o.value="",o.classList.add("bg-gray-100","cursor-not-allowed"))):(t&&(t.disabled=!1,t.classList.remove("bg-gray-100","cursor-not-allowed")),o&&(o.disabled=!1,o.classList.remove("bg-gray-100","cursor-not-allowed")))},0)};window.applyToAll=function(){const e=document.querySelector('[name="monday_open"]').value,a=document.querySelector('[name="monday_close"]').value,n=document.querySelector('[name="monday_closed"]').checked;if(!e||!a){window.toast.error("Please set Monday hours first before applying to other days");return}["tuesday","wednesday","thursday","friday"].forEach(o=>{document.querySelector(`[name="${o}_open"]`).value=e,document.querySelector(`[name="${o}_close"]`).value=a,document.querySelector(`[name="${o}_closed"]`).checked=n,toggleDayClosed(o)}),window.toast.success("Applied Monday hours to all weekdays")};window.copyToAll=function(){const e=document.querySelector('[name="monday_open"]').value,a=document.querySelector('[name="monday_close"]').value,n=document.querySelector('[name="monday_closed"]').checked;if(!e||!a){window.toast.error("Please set Monday hours first before copying to other days");return}["tuesday","wednesday","thursday","friday","saturday","sunday"].forEach(o=>{document.querySelector(`[name="${o}_open"]`).value=e,document.querySelector(`[name="${o}_close"]`).value=a,document.querySelector(`[name="${o}_closed"]`).checked=n,toggleDayClosed(o)}),window.toast.success("Copied Monday hours to all days")};window.closeWeekends=function(){["saturday","sunday"].forEach(e=>{const a=document.querySelector(`[name="${e}_closed"]`);a&&(a.checked=!0,toggleDayClosed(e))}),window.toast.success("Weekends marked as closed")};window.previewHours=function(){const e=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],a=["Monday","Tuesday","Wednesday","Thursday","Friday","Saturday","Sunday"];let n="";e.forEach((t,o)=>{const l=document.querySelector(`[name="${t}_closed"]`);if(l&&l.checked)n+=`${a[o]}: Closed
`;else{const s=document.querySelector(`[name="${t}_open"]`).value,d=document.querySelector(`[name="${t}_close"]`).value;s&&d?n+=`${a[o]}: ${y(s)} - ${y(d)}
`:n+=`${a[o]}: Not set
`}}),w("Operating Hours Preview",n)};function y(e){if(!e)return"";const[a,n]=e.split(":");let t=parseInt(a);const o=t>=12?"PM":"AM";return t>12&&(t-=12),t===0&&(t=12),`${t}:${n} ${o}`}function w(e,a){const n=document.getElementById("general-modal"),t=document.getElementById("modal-title"),o=document.getElementById("modal-content");n&&t&&o&&(t.textContent=e,o.textContent=a,n.classList.remove("hidden"))}window.closeModal=function(){const e=document.getElementById("general-modal");e&&e.classList.add("hidden")};document.addEventListener("DOMContentLoaded",()=>{g(),v(),document.querySelectorAll("form[data-form-type]").forEach(e=>{e.addEventListener("submit",b)})});
